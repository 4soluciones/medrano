<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content roboto-condensed-regular">
        <div class="modal-header bg-warning text-white">
            <h5 class="modal-title">
                <i class="fas fa-edit mr-2"></i>
                Actualizar Sucursal
            </h5>
            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <form id="form-subsidiary-update" action="{% url 'apps.hrm:update_subsidiary' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" value="{{ subsidiary_obj.id }}" id="id-pk" name="pk">
            
            <div class="modal-body p-4">
                <!-- Información Básica -->
                <div class="card border-primary mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0 text-primary">
                            <i class="fas fa-info-circle mr-2"></i>
                            Información Básica
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-hashtag mr-1"></i>
                                        Serie Sucursal
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-serial"
                                           maxlength="4"
                                           name="serial" 
                                           value="{{ subsidiary_obj.serial|default:'' }}"
                                           placeholder="Ej: 001">
                                    <small class="form-text text-muted">Máximo 4 caracteres</small>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-building mr-1"></i>
                                        Nombre de la Sucursal
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-name" 
                                           maxlength="100"
                                           name="name" 
                                           value="{{ subsidiary_obj.name }}"
                                           placeholder="Ingrese el nombre de la sucursal"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="card border-info mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0 text-info">
                            <i class="fas fa-address-book mr-2"></i>
                            Información de Contacto
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-phone mr-1"></i>
                                        Teléfono
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm"
                                           data-inputmask="'mask': ['999-999-999 [x99999]', '+099 99 99 9999[9]-9999']"
                                           data-mask 
                                           id="id-phone" 
                                           name="phone"
                                           value="{{ subsidiary_obj.phone|default:'' }}"
                                           placeholder="Ej: 01-123-4567">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-envelope mr-1"></i>
                                        Correo Electrónico
                                    </label>
                                    <input type="email" 
                                           class="form-control form-control-sm" 
                                           id="id-email" 
                                           maxlength="45"
                                           name="email" 
                                           value="{{ subsidiary_obj.email|default:'' }}"
                                           placeholder="sucursal@empresa.com">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        Dirección
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-address" 
                                           maxlength="200"
                                           name="address" 
                                           value="{{ subsidiary_obj.address|default:'' }}"
                                           placeholder="Ingrese la dirección completa">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información Empresarial -->
                <div class="card border-success mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0 text-success">
                            <i class="fas fa-briefcase mr-2"></i>
                            Información Empresarial
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-id-card mr-1"></i>
                                        RUC
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-ruc" 
                                           maxlength="11"
                                           name="ruc" 
                                           value="{{ subsidiary_obj.ruc|default:'' }}"
                                           placeholder="11 dígitos"
                                           required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-building mr-1"></i>
                                        Razón Social
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-business-name" 
                                           maxlength="100"
                                           name="business-name" 
                                           value="{{ subsidiary_obj.business_name|default:'' }}"
                                           placeholder="Razón social de la empresa"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información del Representante -->
                <div class="card border-warning mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0 text-warning">
                            <i class="fas fa-user-tie mr-2"></i>
                            Información del Representante
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-id-badge mr-1"></i>
                                        DNI del Representante
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-representative-dni" 
                                           maxlength="45"
                                           name="representative-dni" 
                                           value="{{ subsidiary_obj.representative_dni|default:'' }}"
                                           placeholder="Número de documento">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-user mr-1"></i>
                                        Nombre del Representante
                                    </label>
                                    <input type="text" 
                                           class="form-control form-control-sm" 
                                           id="id-representative-name" 
                                           maxlength="100"
                                           name="representative-name" 
                                           value="{{ subsidiary_obj.representative_name|default:'' }}"
                                           placeholder="Nombre completo del representante">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Observaciones -->
                <div class="card border-secondary">
                    <div class="card-header bg-light">
                        <h6 class="mb-0 text-secondary">
                            <i class="fas fa-sticky-note mr-2"></i>
                            Observaciones
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label font-weight-bold">
                                <i class="fas fa-comment mr-1"></i>
                                Observaciones Generales
                            </label>
                            <textarea class="form-control form-control-sm"
                                      id="id-observation-input" 
                                      maxlength="500"
                                      name="observation-input"
                                      rows="3"
                                      placeholder="Ingrese observaciones adicionales si es necesario">{{ subsidiary_obj.observation|default:'' }}</textarea>
                            <small class="form-text text-muted">Máximo 500 caracteres</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-1"></i>
                    Cancelar
                </button>
                <button id="update-subsidiary" type="submit" class="btn btn-warning">
                    <i class="fas fa-save mr-1"></i>
                    Actualizar Sucursal
                </button>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
    // Inicializar máscaras de input
    if ($.fn.inputmask) {
        $('[data-mask]').inputmask();
    }

    // Validación del formulario
    $('#form-subsidiary-update').submit(function (event) {
        event.preventDefault();
        
        // Validar campos requeridos
        let isValid = true;
        $(this).find('[required]').each(function() {
            if (!$(this).val().trim()) {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        if (!isValid) {
            toastr.error('Por favor complete todos los campos requeridos');
            return;
        }

        // Mostrar loading
        $('#update-subsidiary').prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-1"></i>Actualizando...');
        
        let data = new FormData($('#form-subsidiary-update').get(0));
        
        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            headers: {"X-CSRFToken": '{{ csrf_token }}'},
            success: function (response) {
                if (response.success) {
                    toastr.success(response.message);
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    toastr.error(response.message);
                }
            },
            error: function (xhr, status, error) {
                toastr.error('Ocurrió un problema al actualizar la sucursal');
                console.error('Error:', error);
            },
            complete: function() {
                $('#update-subsidiary').prop('disabled', false).html('<i class="fas fa-save mr-1"></i>Actualizar Sucursal');
            }
        });
    });

    // Remover clase de error cuando el usuario empiece a escribir
    $('input, textarea').on('input', function() {
        $(this).removeClass('is-invalid');
    });
});
</script>